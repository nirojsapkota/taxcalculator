
var salary, isYearlyBonusApplicable, isCitDeposited, citPercentage,
    citDepositedAmount=0, isMarried, isInsuranceDone, yearlyInsuranceAmount, taxableAmount,
totalTax,firstSlabTax,secondSlabTax,thirdSlabTax,
firstSlabAmountRange=300000,
firstSlabAmountRangeUnmarried=250000,
totaltaxable,
    secondSlabAmountRange=100000;
    thirdSlabAmountRange=100000;



$(document).ready(function(){

    $("#insurance_deposit").click(function(){
        if($(this).prop("checked")){
            isInsuranceDone=true;
        $("#insurance-div").show();
            
        }else{
            isInsuranceDone=false;

        $("#insurance-div").hide();
        }

    });

    $("#cit_deposit").click(function(){
        if($(this).prop("checked")){
            isCitDeposited=true;
        $("#cit-div").show();
            
        }else{
            isCitDeposited=false;

        $("#cit-div").hide();
        }

    });

    $("#tax-form").submit(function(e){
        e.preventDefault();
        calculate();

    });


});


/*Math.round(input*100)/100
done to round the value to 2 decimal places
*/
function calculate(){
    var salary = $("#salary_per_month").val();
    var yearlySalary;
    citPercentage = $("#cit_percentage").val();
    yearlyInsuranceAmount = $("#insurance_amount").val();

    if($("#is_married").prop("checked")){
        isMarried=true;
    }else{
        isMarried=false;
    }

    if($("#yearly_bonus").prop("checked")){
        isYearlyBonusApplicable=true;
    }else{
        isYearlyBonusApplicable=false;
    }


    if(isYearlyBonusApplicable){
        yearlySalary = salary*13;
    }else{
        yearlySalary = salary*12;
    }

    taxableAmount = yearlySalary;

    if(isCitDeposited){
        citDepositedAmount = Math.round(citPercentage*(salary*12)*100)/100);
        taxableAmount = yearlySalary-citDepositedAmount;
        console.log(citDepositedAmount);

    }

    if(isInsuranceDone){
        if(yearlyInsuranceAmount > 20000){
            taxableAmount = (taxableAmount -20000);
        }else{
            taxableAmount = (taxableAmount -yearlyInsuranceAmount);
            
        }
    }
        totaltaxable = taxableAmount;

    //now calculate tax
    if(!isMarried) {
        firstSlabAmountRange = firstSlabAmountRangeUnmarried;
    }

        if (taxableAmount >= firstSlabAmountRange) {
            firstSlabTax = Math.round(0.01 * taxableAmount*100)/100;
            taxableAmount -= firstSlabAmountRange;
            console.log("firstSlabTax "+firstSlabTax );

        }
            //next slab 15% on 100000
            if(taxableAmount > secondSlabAmountRange){
                secondSlabTax = 15000;
                taxableAmount-=secondSlabAmountRange;
            console.log("secondSlabTax "+secondSlabTax );


            }
            //final slab i.e. upto 25l
            if(taxableAmount > 0 && taxableAmount < 2500000){
                thirdSlabTax = Math.round(.25*taxableAmount*100)/100;
            console.log("thirdSlabTax "+thirdSlabTax );

            }

            totalTax = firstSlabTax+secondSlabTax+thirdSlabTax;
    console.log(totalTax);


var append_data = {
    monthly_salary: salary,
    cit_deposit: Math.round(citDepositedAmount/12*100)/100,
    insurance_deposit: Math.round(yearlyInsuranceAmount/12*100)/100,
    yearly_salary: yearlySalary,
    total_taxable: totaltaxable,
    first_slab: firstSlabTax,
    second_slab: secondSlabTax,
    third_slab: thirdSlabTax,
    total_tax: totalTax,
    tax_per_month: Math.round(totalTax/12*100)/100
}


var source = $("#tax-template").html();
var template = Handlebars.compile(source);
var html = template(append_data);
$("#tax-row").append(html);
$("#info-table").show();


}


